<!-- dashboard.html -->
<div class="container">
    <script type="text/javascript">

        // Resend e-mail verification
        function onClickEmailVerification() {
            sendEmailVerification("Resend Verification E-Mail",
                "Sent! If you dont see the E-Mail, check your spam folder.");
        }

        // Update the page layout depending on if the user has
        // verified their e-mail or not.
        function refreshLayout() {
            var user = firebase.auth().currentUser;
            if (user && user.emailVerified) {
                if (!$("#verify-email").hasClass("div-collapsed"))
                    $("#verify-email").addClass("div-collapsed");
                $("#dashboard-content").removeClass("div-collapsed");

            } else if (user) {
                if (!$("#dashboard-content").hasClass("div-collapsed"))
                    $("#dashboard-content").addClass("div-collapsed");
                $("#verify-email").removeClass("div-collapsed");
            }
            else { return; }
        }

        // Monitor for a change in currentUser.userVerified
        async function pollVerification() {
            var user = firebase.auth().currentUser;
            // If user logs out or becomes verified, break
            while (user != null && !user.emailVerified) {
                await sleep(3000);
                user = refreshCurrentUser();
            }
            // Change the dashboard's displayed layout
            refreshLayout();
        }

        //
        // Init Page
        //
        (function () {
            // Setup up the initial page layout
            refreshLayout();

            // Register event listeners
            $("#verify-email-button").bind("click", onClickEmailVerification);

            // Polls for a change in the currentUser's .emailVerified field.
            pollVerification();
        })();

        var quotes = {
            "new": function (jQuery) {
                // Pick a random quote
                var index = Math.floor(Math.random() * 24);  // Get rid of the constant

                var quote = this["q" + index];  // Pull this from firebase "modules/quote-engine/q" + index

                $(jQuery).html((quote.quote + " –" + quote.author).replace("–", " –<i>" + "<//i>"));
            },
            "tweet": function (jQuery) {
                var w = 500;
                var h = 300;
                var left = Number((screen.width / 2) - (w / 2));
                var top = Number((screen.height / 2) - (h / 2));
                window.open('https://twitter.com/intent/tweet?text=' + encodeURI($(jQuery).text()), "Tweet", "'toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, height=" + h + ",width=" + w + ",left=" + left + ",top=" + top);
            }
        };

    </script>

    <div class="container-fluid">
        <!-- This is the section that is displayed if the user has not verified their e-mail -->
        <div id="verify-email" class="div-collapsed">
            <div class="d-flex justify-content-center">
                <h3>Please verify your e-mail address</h3>
            </div>
            <div class="d-flex justify-content-center">
                <a id="verify-email-button" class="btn btn-primary btn-outline-light" href="#">Resend Verification E-Mail</a>
            </div>
        </div>
        <!-- This is the section that is displayed if the user has verified their e-mail -->
        <div id="dashboard-content" class="div-collapse page-view">
            <div class="row">
                <div class="col-lg-8 d-none d-lg-block">
                    Welcome to the Dashboard.
                </div>
                <div class="col-lg-4 pt-3 pl-5">
                    <!-- Current user name or e-mail -->
                    <div id="user-info text-dark">
                        Logged in as
                        <span>{{ stateInformation.currentUser.email }}</span>.
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>